---
- file: path={{nginx}}/hosts/{{host}}:{{port|default(80)}}.d state=directory
- template: src={{conf}} dest={{nginx}}/hosts/{{host}}:{{port}}.d/{{name}}.conf
- file: path={{nginx}}/global.d state=directory
- assemble: src={{nginx}}/global.d dest={{nginx}}/hosts/global.conf
- template: src=files/nginx/host-open.conf dest={{nginx}}/hosts/{{host}}:{{port}}.d/00-host.conf
- file: src={{nginx}}/hosts/global.conf dest={{nginx}}/hosts/{{host}}:{{port}}.d/01-global.conf state=link
- template: src=files/nginx/host-close.conf dest={{nginx}}/hosts/{{host}}:{{port}}.d/99-host.conf
- assemble: src={{nginx}}/hosts/{{host}}:{{port}}.d dest={{nginx}}/conf.d/{{host}}:{{port}}.conf
