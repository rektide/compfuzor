{%- macro pkgs() -%}
{%- set sep=joiner(', ') -%}
{%- for ps in pkgsets -%}
{{sep()}}{{vars[ps]|default(hostvars[inventory_hostname][ps])|join(', ')}}
{%- endfor -%}
{%- endmacro -%}

architecture: {{arch}}

actions:
  - action: debootstrap
    suite: "sid"
    components:
      - contrib
      - main
      - non-free
    mirror: https://deb.debian.org/debian
    variant: minbase

  - action: apt
    packages: [ {{pkgs()}} ]

  - action: run
    chroot: true
    command: echo debos > /etc/hostname

  - action: pack
    file: debian.tgz
    compression: gz
